{% extends '/procurement/base/default-procurement-page.html' %}
{% import '/base/components/paginations/pagination.html' as paginated %}
{% import '/procurement/macros/table.html' as table_macros %}
{% from '/base/components/breadcrumbs.html' import RenderBreadcrumb %}
{% block title %}รายการขอซื้อขอจ้าง{% endblock %}
{% block dashboard_title %}รายการขอซื้อขอจ้าง{% endblock %}

{% block content %}
  <div class="container mx-auto px-4 py-6">
    <div class="flex items-center justify-between mb-4">
      <div class="bg-blue-50 border border-blue-200 rounded-full px-4 py-2">
        <span class="text-blue-700 font-semibold text-sm">{{ requisitions|length }} รายการ</span>
      </div>
    </div>

    <div class="flex items-center justify-between mb-4">
      <form method="GET" action="{{ url_for("procurement.requisitions.renewal_requested") }}" class="mb-6">
        <div class="flex items-center gap-4">
          <!-- Filter by Requisition Code -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">เลขที่คำขอ</span>
            </label>
            <input type="text"
                   name="requisition_code"
                   value="{{ request.args.get('requisition_code', '') }}"
                   class="input input-bordered"
                   placeholder="ค้นหาเลขที่คำขอ" />
          </div>

          <!-- Filter by Status -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">สถานะ</span>
            </label>
            <select name="status" class="select select-bordered">
              <option value="">-- เลือกสถานะ --</option>
              {% for value, label in status_choices %}
                <option value="{{ value }}" {% if request.args.get('status') == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>
          <!-- filter by my user -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">แสดงรายการ</span>
            </label>
            <select name="show_item" class="select select-bordered">
              {% for value, label in show_item_choices %}
                <option value="{{ value|default("all") }}"
                        {% if request.args.get('show_item') == value %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- ปุ่มล้างการค้นหา -->
          {% if request.args.get('status') or request.args.get('requisition_code') %}
            <a href="{{ url_for("procurement.requisitions.renewal_requested") }}"
               class="btn btn-sm btn-ghost mt-6">
              <i class="ph ph-x"></i> ล้าง
            </a>
          {% endif %}
          <!-- Submit Button -->
          <div class="form-control mt-6">
            <button type="submit" class="btn btn-primary">
              <i class="ph ph-magnifying-glass"></i>
              ค้นหา
            </button>
          </div>
        </div>
      </form>

      <a href="{{ url_for('procurement.requisitions.create_or_edit', organization_id=organization.id) }}"
         class="btn btn-primary">
        <i class="ph ph-plus"></i>
        สร้างรายการขอจัดซื้อ
      </a>
    </div>
    {% if current_user.has_organization_roles("manager") %}
      <h1 class="text-xl font-bold">รายการขอซื้อขอจ้างที่รอการพิจารณา</h1>
      {{ table_macros.render_renewal_requested_items_table(manager_requisitions,current_user, mas_list, organization, manager_action=true) }}
    {% endif %}
    <h1 class="text-xl font-bold mt-6">รายการขอซื้อขอจ้างทั้งหมด</h1>
    {{ table_macros.render_renewal_requested_items_table(requisitions,current_user, mas_list, organization, manager_action=false) }}
  </div>
{% endblock %}
