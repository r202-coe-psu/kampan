{% block header %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ใบแจ้งขอซื้อ/จ้างวัสดุ</title>
    <style>
        body,
        th,
        td {
            font-family: 'TH Sarabun New', 'Laksaman', Arial, sans-serif;
        }

        @page {
            size: A4;
            margin: 15mm;
        }

        body {
            width: 210mm;
            height: 297mm;
            margin: 0;
            background: #fff;
            font-size: 18px;
        }

        div {
            margin-top: 0.2rem;
            vertical-align: middle;
            font-family: 'TH Sarabun New', 'Laksaman', Arial, sans-serif;
        }

        span {
            vertical-align: middle;
            font-family: 'TH Sarabun New', 'Laksaman', Arial, sans-serif;
        }
    </style>
</head>
{% endblock header %}


{% block content %}
{% set now = now or datetime.datetime.now() %}

<body>
    <div class="content">
        <div style="display: grid; grid-template-columns: 1fr 1.5fr 1.2fr; align-items: center; margin-top: -1rem">
            <div></div>
            <div>
                <p style="text-align: center;">ใบแจ้งขอซื้อ/จ้างวัสดุ</p>
            </div>
            <div
                style="border: 2px solid #333; border-radius: 6px; padding: 12px; margin: 0 8px; text-align: right; margin-top: 2rem;">
                <p style="margin: 2;">เลขที่ ........................
                    <span style="position: absolute; left: 42rem; white-space: nowrap;">
                        {{ requisitions.requisition_code }}
                    </span>
                </p>
                <p style="margin: 2;">วันที่รับ .............................</p>
                <p style="margin: 2;">
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">E-mail</span>
                    </span>
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">sharepoint</span>
                    </span>
                </p>
            </div>
        </div>
        <div style="text-align: right; position: relative;">
            <span style="margin: 2; display: inline-block; position: relative;">
                วันที่ ........
                <span style="position: absolute; right: 0.7rem;">
                    {{ now.day }}
                </span>
            </span>
            <span style="margin: 2; display: inline-block; position: relative;">
                เดือน .........................
                <span style="position: absolute; right: 2rem; top: -0.2rem;">
                    {{ ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม",
                    "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"][now.month-1] }}
                </span>
            </span>
            <span style="margin: 2; display: inline-block; position: relative;">
                พ.ศ. ...............
                <span style="position: absolute; right: 1.5rem;">
                    {{ now.year + 543 }}
                </span>
            </span>
        </div>
        <div>
            <span>เรียน</span>
            <span>ผู้อำนวยการสำนักนวัตกรรมดิจิทัลและระบบอัจฉริยะ</span>
        </div>
        <div style="text-align: right;">
            <span>ข้าพเจ้า</span>
            <span style="position: relative;">
                นาย/นาง/นางสาว .................................................
                <span style="position: absolute; left: 10rem; top: -0.4rem; white-space: nowrap;">
                    {%- set fullname = requisitions.purchaser.display_fullname() if requisitions.purchaser and
                    requisitions.purchaser.display_fullname is defined else requisitions.purchaser|string -%}
                    {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                </span>
            </span>
            <span style="position: relative;">
                ฝ่าย .................................
                <span style="position: absolute; left: 2.5rem; top: -0.4rem; white-space: nowrap;">
                    {{ requisitions.purchaser.division.name[4:] if
                    requisitions.purchaser.division.name.startswith('ฝ่าย') else requisitions.purchaser.division.name }}
                </span>
            </span>
            <span style="position: relative;">
                โทร .................
                <span style="position: absolute; right: 1.5rem; white-space: nowrap;">
                    {{ requisitions.phone if requisitions.phone else '' }}
                </span>
            </span>
        </div>
        <div>
            <span>มีความต้องการ</span>
            {% set categories = requisitions.items | map(attribute='category') | list %}
            <span>
                <input type="checkbox" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;" {%
                    if 'software' in categories %}checked{% endif %}>
                <span style="vertical-align: middle;">ซื้อวัสดุ</span>
            </span>
            <span>
                <input type="checkbox" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;" {%
                    if 'product' in categories %}checked{% endif %}>
                <span style="vertical-align: middle;">ซื้อครุภัณฑ์</span>
            </span>
            <span>
                <input type="checkbox" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;" {%
                    if 'service' in categories %}checked{% endif %}>
                <span style="vertical-align: middle;">จ้างเหมา</span>
            </span>
            <span>
                ดังรายการต่อไปนี้
            </span>
        </div>
        {% set sorted_items = requisitions.items|sort(attribute='product_name') %}
        {% for i in range(4) %}
        <div>
            <span>{{ i+1 }}</span>
            <span style="position: relative;">
                <span
                    style="position: absolute; left: 15; top: -0.5rem; white-space: normal; max-width: 350px; overflow-wrap: break-word; line-height: 1.6;">
                    {% if sorted_items and sorted_items|length > i %}
                    {{ sorted_items[i].product_name }}
                    {% endif %}
                </span>
                ................................................................................
            </span>
            <span style="position: relative;">
                <span style="position: absolute; left: 5rem; white-space: nowrap;">
                    {% if sorted_items and sorted_items|length > i %}
                    {{ sorted_items[i].quantity }}
                    {% endif %}
                </span>
                จำนวน ..............
            </span>
            <span style="position: relative;">
                <span style="position: absolute; left: 7rem; white-space: nowrap;">
                    {% if sorted_items and sorted_items|length > i %}
                    {{ "{:,.2f}".format(sorted_items[i].amount) }}
                    {% endif %}
                </span>
                ราคาประมาณ ......................
            </span>
            <span>บาท</span>
        </div>
        {% endfor %}
        <div style="text-align: right;">
            <span style="position: relative;">
                <span style="position: absolute; left: 10rem; white-space: nowrap;">
                    {{ "{:,.2f}".format(sorted_items | map(attribute='amount') | sum) if sorted_items else '0.00' }}
                </span>
                รวมเป็นเงินประมาณ ......................
            </span>
            <span>บาท</span>
        </div>
    </div>
    <div>
        <span>เหตุผลที่ต้องการใช้
            <span
                style="position: absolute; left: 10rem; white-space: normal; max-width: 550px; overflow-wrap: break-word; line-height: 1.2;">
                {{ requisitions.reason }}
            </span>
        </span>
        <span>...................................................................................................................................</span>
        <span>...............................................................................................................................................................</span>
    </div>
    <div>
        <span>ข้าพเจ้าต้องการใช้วัสดุ/ ครุภัณฑ์/ จ้างเหมา งานแล้วเสร็จ ภายในวันที่</span>
        <span>........
            <span style="position: absolute; left: 30.5rem;">
                {{ requisitions.start_date.day if requisitions.start_date }}
            </span>
        </span>
        <span>เดือน .......................
            <span style="position: absolute; left: 36rem; top: 28.7rem">
                {{ ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม",
                "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"][requisitions.start_date.month-1] if requisitions.start_date
                }}
            </span>
        </span>
        <span>พ.ศ. ..............
            <span style="position: absolute; left: 46rem;">
                {{ requisitions.start_date.year + 543 if requisitions.start_date }}
            </span>
        </span>
    </div>
    <div style="text-align: center;">จึงเรียนมาเพื่อโปรดพิจารณา</div>
    <div style="text-align: right; margin-top: 0.5rem;">
        <span>(ลงชื่อ)</span>
        <span>...................................</span>
        <span>ผู้ใช้บริการ</span>
    </div>
    <div style="text-align: right; margin-top: 0.5rem;">
        <span>(ลงชื่อ)</span>
        <span>..................................</span>
        <span>หัวหน้าฝ่าย</span>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr;">
        <div style="text-align: left; margin-top: -1.4rem;">
            <p><b>คณะกรรมการตรวจรับ</b></p>
            <p style="font-size: 15px; margin-top: -1rem">(วงเงินไม่เกิน 100,000.- บาท กรรมการตรวจรับ 1 คน)</p>
            <div style="margin-top: -1rem;">
                <span>1</span>
                <span>........................................
                    <span style="position: absolute; left: 2rem; top: 39.8rem; white-space: nowrap;">
                        {%- set chairman = inspection_committees | selectattr('committee_position', 'equalto',
                        'chairman') | list -%}
                        {%- if chairman and chairman[0].member and chairman[0].member.display_fullname is defined -%}
                        {%- set fullname = chairman[0].member.display_fullname() -%}
                        {%- elif chairman and chairman[0].member -%}
                        {%- set fullname = chairman[0].member|string -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>ประธานกรรมการ</span>
            </div>
            <div>
                <span>2</span>
                <span>........................................
                    <span style="position: absolute; left: 2rem; top: 41.6rem; white-space: nowrap;">
                        {%- set members = inspection_committees | selectattr('committee_position', 'equalto',
                        'member') | list -%}
                        {%- if members and members|length > 0 -%}
                        {%- set member = members[0].member -%}
                        {%- if member and member.display_fullname is defined -%}
                        {%- set fullname = member.display_fullname() -%}
                        {%- else -%}
                        {%- set fullname = member|string -%}
                        {%- endif -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>กรรมการ</span>
            </div>
            <div>
                <span>3</span>
                <span>........................................
                    <span style="position: absolute; left: 2rem; top: 43.5rem; white-space: nowrap;">
                        {%- set members = inspection_committees | selectattr('committee_position', 'equalto',
                        'member') | list -%}
                        {%- if members and members|length > 1 -%}
                        {%- set member = members[1].member -%}
                        {%- if member and member.display_fullname is defined -%}
                        {%- set fullname = member.display_fullname() -%}
                        {%- else -%}
                        {%- set fullname = member|string -%}
                        {%- endif -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>กรรมการ</span>
            </div>
        </div>
        <div style="text-align: left; margin-left: 3rem;">
            <p><b>คณะกรรมการกำหนดคุณลักษณะเฉพาะวัสดุ</b></p>
            <div style="margin-top: -1rem;">
                <span>1</span>
                <span>........................................
                    <span style="position: absolute; left: 30rem; top: 39.8rem; white-space: nowrap;">
                        {%- set chairman = specification_committees | selectattr('committee_position', 'equalto',
                        'chairman') | list -%}
                        {%- if chairman and chairman[0].member and chairman[0].member.display_fullname is defined -%}
                        {%- set fullname = chairman[0].member.display_fullname() -%}
                        {%- elif chairman and chairman[0].member -%}
                        {%- set fullname = chairman[0].member|string -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>ประธานกรรมการ</span>
            </div>
            <div>
                <span>2</span>
                <span>........................................
                    <span style="position: absolute; left: 30rem; top: 41.6rem; white-space: nowrap;">
                        {%- set members = specification_committees | selectattr('committee_position', 'equalto',
                        'member') | list -%}
                        {%- if members and members|length > 0 -%}
                        {%- set member = members[0].member -%}
                        {%- if member and member.display_fullname is defined -%}
                        {%- set fullname = member.display_fullname() -%}
                        {%- else -%}
                        {%- set fullname = member|string -%}
                        {%- endif -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>กรรมการ</span>
            </div>
            <div>
                <span>3</span>
                <span>........................................
                    <span style="position: absolute; left: 30rem; top: 43.7rem; white-space: nowrap;">
                        {%- set members = specification_committees | selectattr('committee_position', 'equalto',
                        'member') | list -%}
                        {%- if members and members|length > 1 -%}
                        {%- set member = members[1].member -%}
                        {%- if member and member.display_fullname is defined -%}
                        {%- set fullname = member.display_fullname() -%}
                        {%- else -%}
                        {%- set fullname = member|string -%}
                        {%- endif -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>กรรมการ</span>
            </div>
        </div>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; margin-top: -2rem;">
        <div style="text-align: left;">
            <p><b>คณะกรรมการจัดซื้อ</b><span> (วงเงินมากกว่า 500,000.- บาท)</span></p>
            <div style="margin-top: -1rem;">
                <span>1</span>
                <span>........................................
                    <span style="position: absolute; left: 2rem; top: 48.2rem; white-space: nowrap;">
                        {%- set chairman = procurement_committees | selectattr('committee_position', 'equalto',
                        'chairman') | list -%}
                        {%- if chairman and chairman[0].member and chairman[0].member.display_fullname is defined -%}
                        {%- set fullname = chairman[0].member.display_fullname() -%}
                        {%- elif chairman and chairman[0].member -%}
                        {%- set fullname = chairman[0].member|string -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>ประธานกรรมการ</span>
            </div>
            <div>
                <span>2</span>
                <span>........................................
                    <span style="position: absolute; left: 2rem; top: 50rem; white-space: nowrap;">
                        {%- set members = procurement_committees | selectattr('committee_position', 'equalto',
                        'member') | list -%}
                        {%- if members and members|length > 0 -%}
                        {%- set member = members[0].member -%}
                        {%- if member and member.display_fullname is defined -%}
                        {%- set fullname = member.display_fullname() -%}
                        {%- else -%}
                        {%- set fullname = member|string -%}
                        {%- endif -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>กรรมการ</span>
            </div>
            <div>
                <span>3</span>
                <span>........................................
                    <span style="position: absolute; left: 2rem; top: 51.8rem; white-space: nowrap;">
                        {%- set members = procurement_committees | selectattr('committee_position', 'equalto',
                        'member') | list -%}
                        {%- if members and members|length > 1 -%}
                        {%- set member = members[1].member -%}
                        {%- if member and member.display_fullname is defined -%}
                        {%- set fullname = member.display_fullname() -%}
                        {%- else -%}
                        {%- set fullname = member|string -%}
                        {%- endif -%}
                        {%- else -%}
                        {%- set fullname = '' -%}
                        {%- endif -%}
                        {{ fullname.split('(')[0].strip() if '(' in fullname else fullname }}
                    </span>
                </span>
                <span>กรรมการ</span>
            </div>
        </div>
        <div style="text-align: left; margin-left: 3rem;">
            <p><b>คณะกรรมการราคากลาง</b></p>
            <div style="margin-top: -1rem;">
                <span>1</span>
                <span>........................................</span>
                <span>ประธานกรรมการ</span>
            </div>
            <div>
                <span>2</span>
                <span>........................................</span>
                <span>กรรมการ</span>
            </div>
            <div>
                <span>3</span>
                <span>........................................</span>
                <span>กรรมการ</span>
            </div>
        </div>
    </div>
    <table
        style="width: 100%; min-width: 100%; max-width: 100%; height: 240px; table-layout: fixed; border-collapse: collapse; margin: 1rem 0 0 0;">
        <tr>
            <td style="border: 1px solid #333; border-left: none; padding: 8px; vertical-align: top;">
                <p>(สำหรับเจ้าหน้าที่วัสดุ)</p>
                <p style="margin-top: -1rem;">
                    <span>แหล่งเงินที่ใช้</span>
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">เงินรายได้</span>
                        <span>......................................</span>
                    </span>
                </p>
                <p style="margin-top: -0.5rem;">
                    <span style="margin-left: 5.4rem;">
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">เงินงบประมาณ</span>
                        <span>..............................</span>
                    </span>
                </p>
                <p style="margin-top: -0.5rem;">
                    <span style="margin-left: 5.4rem;">
                        <span style="vertical-align: middle;">...................</span>
                        <span style="margin-left: 2rem;">........../........./...........</span>
                    </span>
                </p>
            </td>
            <td style="border: 1px solid #333; border-right: none;padding: 8px; vertical-align: top;">
                <p>ได้รับทราบผลพิจารณาแล้ว</p>
                <p style="margin-top: -0.5rem; text-align: right;">
                    <span>...............................</span>
                    <span>ผู้ใช้บริการ</span>
                </p>
                <p style="text-align: right; margin-top: -0.5rem;">.............../.............../...............</p>
            </td>
        </tr>
        <tr>
            <td
                style="border: 1px solid #333; border-left: none; border-bottom: none; padding: 8px; vertical-align: top;">
                <p>
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">อนุมัติ</span>
                    </span>
                </p>
                <p style="margin-top: -1rem;">
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">ไม่อนุมัติ เพราะ</span>
                        <span>..................................................</span>
                    </span>
                </p>
                <p style="margin-top: -0.5rem; text-align: right; margin-right: 1.5rem;">
                    <span>...................................</span>
                    <span>ผู้อนุมัติ</span>
                </p>
                <p style="text-align: right; margin-top: -0.5rem; margin-right: 1.5rem;">
                    .............../.............../...............</p>
            </td>
            <td
                style="border: 1px solid #333; border-right: none; border-bottom: none; padding: 8px; vertical-align: top;">
                <p>
                    <span>จัดซื้อเรียบร้อยแล้ว</span>
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">ทันเวลา</span>
                    </span>
                    <span>
                        <input type="checkbox"
                            style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
                        <span style="vertical-align: middle;">ไม่ทันเวลา</span>
                    </span>
                </p>
                <p style="margin-top: -1rem;">
                    <span>เนื่องจาก</span>
                    <span>.......................................................................</span>
                </p>
                <p style="margin-top: -1rem;">
                    <span>เบิกจ่าย มอ. 011/</span>
                    <span>................</span>
                    <span>วันที่อนุมัติเบิกจ่าย</span>
                    <span>...............</span>
                </p>
                <p style="margin-top: -1rem;">
                    <span>ร้าน</span>
                    <span>.......................................</span>
                    <span>จำนวนเงิน</span>
                    <span>.......................</span>
                </p>
                <p style="margin-top: -1rem;">
                    <span>ตรวจรับวันที่</span>
                    <span>.............../.............../...............</span>
                </p>
            </td>
        </tr>
    </table>
    <script>
        window.onload = function () {
            window.print();
        };
    </script>
</body>

{% endblock content %}