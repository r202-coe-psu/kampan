{% extends '/procurement/base/default-procurement-page.html' %}

{% block title %}ปีงบประมาณ{% endblock %}
{% block dashboard_title %}ปีงบประมาณ{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">จัดการปีงบประมาณ</h1>
        <a href="{{ url_for('procurement.tor_years.create_or_edit', organization_id=organization.id) }}"
            class="btn btn-primary">เพิ่มปีงบประมาณ</a>
    </div>
    <div class="card bg-base-100 shadow-xl border border-base-200">
        <div class="card-body p-0">
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <thead>
                        <tr>
                            <th>ปีงบประมาณ</th>
                            <th>วันเริ่มต้น</th>
                            <th>วันสิ้นสุด</th>
                            <th class="text-center">Tools</th>
                            <th class="text-center">Setting</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for y in tor_years %}
                        <tr>
                            <td>{{ y.year }}</td>
                            <td>{{ y.started_date.strftime('%d/%m/%Y') if y.started_date else '-' }}</td>
                            <td>{{ y.ended_date.strftime('%d/%m/%Y') if y.ended_date else '-' }}</td>
                            <td class="text-center">
                                <a href="{{ url_for('procurement.tor_years.create_or_edit', tor_year_id=y.id, organization_id=organization.id) }}"
                                    class="btn btn-sm btn-warning mr-2">แก้ไข</a>
                                <a href="{{ url_for('procurement.tor_years.copy_tor_year', tor_year_id=y.id, organization_id=organization.id) }}"
                                    class="btn btn-sm btn-info">คัดลอกปีถัดไป</a>
                            </td>
                            <td class="text-center">
                                <form method="post"
                                    action="{{ url_for('procurement.tor_years.set_default_tor_year', tor_year_id=y.id, organization_id=organization.id) }}">
                                    <button type="submit"
                                        class="btn btn-xs {% if current_user.user_setting and current_user.user_setting.tor_year and current_user.user_setting.tor_year.id == y.id %}btn-success{% else %}btn-outline{% endif %}">
                                        {% if current_user.user_setting and current_user.user_setting.tor_year and
                                        current_user.user_setting.tor_year.id == y.id %}
                                        ใช้งานอยู่
                                        {% else %}
                                        ตั้งเป็นค่าเริ่มต้น
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-gray-400 py-8">ไม่มีข้อมูลปีงบประมาณ</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}