{% extends '/procurement/base/default-procurement-page.html' %}

{% block title %}คัดลอกปีงบประมาณ - พบข้อมูลเดิม{% endblock %}
{% block dashboard_title %}คัดลอกปีงบประมาณ - พบข้อมูลเดิม{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <div class="max-w-2xl mx-auto">
        <!-- Alert Card -->
        <div class="alert alert-warning mb-6">
            <i class="ph ph-warning-circle text-2xl"></i>
            <div>
                <h3 class="font-bold text-lg">พบปีงบประมาณที่ถูกลบไว้แล้ว</h3>
                <div class="text-sm">
                    พบปีงบประมาณ <span class="font-bold">{{ existing_year.year }}</span> 
                    ที่เคยถูกลบไว้แล้วในระบบ
                </div>
            </div>
        </div>

        <!-- Existing Year Details Card -->
        <div class="card bg-base-100 shadow-xl border border-base-200 mb-6">
            <div class="card-body">
                <h2 class="card-title text-warning">
                    <i class="ph ph-archive-box"></i>
                    ข้อมูลปีงบประมาณที่ถูกลบ
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <label class="font-medium text-sm text-base-content/70">ปีงบประมาณ:</label>
                        <p class="font-bold text-lg">{{ existing_year.year }}</p>
                    </div>
                    <div>
                        <label class="font-medium text-sm text-base-content/70">สถานะ:</label>
                        <p><span class="badge badge-error">ถูกลบแล้ว</span></p>
                    </div>
                    <div>
                        <label class="font-medium text-sm text-base-content/70">วันเริ่มต้น:</label>
                        <p>{{ existing_year.started_date.strftime('%d/%m/%Y') if existing_year.started_date else '-' }}</p>
                    </div>
                    <div>
                        <label class="font-medium text-sm text-base-content/70">วันสิ้นสุด:</label>
                        <p>{{ existing_year.ended_date.strftime('%d/%m/%Y') if existing_year.ended_date else '-' }}</p>
                    </div>
                    <div>
                        <label class="font-medium text-sm text-base-content/70">สร้างโดย:</label>
                        <p>{{ existing_year.created_by.get_resources_fullname_th() if existing_year.created_by else '-' }}</p>
                    </div>
                    <div>
                        <label class="font-medium text-sm text-base-content/70">วันที่สร้าง:</label>
                        <p>{{ existing_year.created_date.strftime('%d/%m/%Y %H:%M') if existing_year.created_date else '-' }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Options Card -->
        <div class="card bg-base-100 shadow-xl border border-base-200">
            <div class="card-body">
                <h2 class="card-title">
                    <i class="ph ph-question"></i>
                    คุณต้องการทำอย่างไร?
                </h2>
                <p class="text-base-content/70 mb-6">
                    เลือกการดำเนินการใดการดำเนินการหนึ่งด้านล่าง
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Restore Option -->
                    <div class="card bg-success/10 border border-success/20">
                        <div class="card-body text-center">
                            <div class="text-success text-4xl mb-2">
                                <i class="ph ph-arrow-counter-clockwise"></i>
                            </div>
                            <h3 class="font-bold text-success">กู้คืนข้อมูลเดิม</h3>
                            <p class="text-sm text-base-content/70 mb-4">
                                เปิดใช้งานปีงบประมาณ {{ existing_year.year }} ที่เคยถูกลบไว้
                            </p>
                            <form method="post" action="{{ url_for('procurement.tor_years.restore_tor_year', existing_year_id=existing_year.id, organization_id=organization.id) }}">
                                <button type="submit" class="btn btn-success btn-sm w-full">
                                    <i class="ph ph-check"></i>
                                    กู้คืนข้อมูล
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Create New Option -->
                    <div class="card bg-primary/10 border border-primary/20">
                        <div class="card-body text-center">
                            <div class="text-primary text-4xl mb-2">
                                <i class="ph ph-plus-circle"></i>
                            </div>
                            <h3 class="font-bold text-primary">สร้างใหม่ทับข้อมูลเดิม</h3>
                            <p class="text-sm text-base-content/70 mb-4">
                                อัพเดทข้อมูลปีงบประมาณ {{ existing_year.year }} ด้วยข้อมูลใหม่จากปี {{ source_tor_year.year }}
                            </p>
                            <form method="post" action="{{ url_for('procurement.tor_years.force_copy_tor_year', tor_year_id=source_tor_year.id, organization_id=organization.id) }}">
                                <button type="submit" class="btn btn-primary btn-sm w-full">
                                    <i class="ph ph-plus"></i>
                                    สร้างใหม่
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Cancel Option -->
                <div class="flex justify-center mt-6">
                    <a href="{{ url_for('procurement.tor_years.index', organization_id=organization.id) }}" 
                       class="btn btn-outline">
                        <i class="ph ph-x"></i>
                        ยกเลิก
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
